<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="admin">
	<!--게시글 조회 쿼리 -->
	<select id = "selectAll" resultType = "adminDTO">
		select @rownum := @rownum +1 rownumber, a.board_textname , a.user_name , a.board_texttime, board_id  
		from (select board_id, board_textname,u.user_name, board_texttime from tbl_user u join tbl_board tb where u.user_num =tb.user_num and board_boardtype  ='01' order by board_id desc) a, 	
		(select @rownum :=0) rownum;
	</select>

	<!-- 홍보 게시글 쿼리 -->
	<select id = "selectPromotion" resultType = "adminDTO">
		select @rownum := @rownum +1 rownumber, a.board_textname , a.user_name , a.board_texttime 
		from (select board_id, board_textname, u.user_name, board_texttime from tbl_user u join tbl_board tb where u.user_num =tb.user_num and board_boardtype  ='02' order by board_id desc) a, 	
		(select @rownum :=0) rownum;
	</select>

	<!-- 리뷰 게시글 쿼리 -->
	<select id = "selectReview" resultType = "adminDTO">
		select @rownum := @rownum +1 rownumber, a.board_textname , a.user_name , a.board_texttime 
		from (select board_id, board_textname, u.user_name, board_texttime from tbl_user u join tbl_board tb where u.user_num =tb.user_num and board_boardtype  ='03' order by board_id desc) a, 	
		(select @rownum :=0) rownum;
	</select>

	<!-- 관리자 게시판 등록 쿼리 -->
	<insert id = "insertBoard" parameterType = "adminVO">	
	INSERT INTO hot6else.tbl_board
	VALUES(#{boardId}, #{boardTextName}, '00', '', SYSDATE(), SYSDATE(), #{boardMainText}, '', '', '', 0, '', #{userNum});
	</insert>
	
	<select id = "mainNotice" resultType = "noticeVO">
		select no_id , no_textname , no_maintext , no_texttime  from tbl_notice tn order by no_texttime desc 
	</select>

	<select id ="selectNotice" resultType = "noticeVO">
		select no_id, no_textName, no_maintext, no_textTime, no_writer from tbl_notice
	</select>
	
	<select id = "mainAdmNotice" resultType = "adminVO">
		select board_textname , board_texttime from tbl_board tb order by board_texttime desc ;
	</select>

	<select id = "mainInquiry" resultType = "inquiryVO">
		select iq_textname, iq_texttime from tbl_inquiry order by iq_texttime desc
	</select>

	<select id = "selectInquiry" resultType = "inquiryDTO">
		select iq_id , iq_textname, iq_texttime , iq_answerYN , user_name from tbl_user u join tbl_inquiry ti
		where u.user_num = ti.user_num
	</select>

	<select id = "selectAllUser" resultType = "userDTO">
		select user_name, user_email, user_since ,user_point,user_trust, user_phonenum, user_address from tbl_user tu
	</select>
	<select id = "selectUserCount" resultType = "_int">
		select count(user_name) total from tbl_user
	</select>
	
	<select id = "detailInquiry" resultType = "inquiryDTO">
	select iq_id, iq_textname , iq_maintext , iq_texttime , u.user_num, u.user_name  
	from tbl_user u join tbl_inquiry ti where iq_id = #{iqId} and u.user_num =ti.user_num ;
	</select>
	
	<select id = "todayInquiry" resultType = "_int">
		select count(iq_id) from tbl_inquiry ti where  DATE_FORMAT(iq_texttime,'%Y-%m-%d') =  DATE_FORMAT( sysdate(),'%Y-%m-%d')
	</select> 
	
	<select id ="todaySign" resultType = "_int">
		select count(user_num) from tbl_user tu where  DATE_FORMAT(user_since,'%Y-%m-%d') =  DATE_FORMAT( sysdate(),'%Y-%m-%d')
	</select>
	
	<insert id="rejectInsert">
		insert into (요청거절테이블)
		values (게시글 번호, 게시글 제목, 작성자)
	</insert>

	<delete id="reqTableDelete" >
		delete from (요청/신청 테이블)
		where (승인/거절 버튼이 눌린 거)
	</delete>
	
	<insert id="noticeInsert" >
		insert into (관리자공지)
		values (글제목, 작성날짜, 작성자)
	</insert>

</mapper>